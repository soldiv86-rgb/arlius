-- Variables
local petId = "{9c8926b2-0362-4019-85e7-905ea7a8433a}"
local fruitName = "Carrot [0.38kg]"
local autoFavorite = false

-- Function to start auto-favoriting fruit
local function startAutoFavorite()
    if autoFavorite then return end
    autoFavorite = true
    spawn(function()
        while autoFavorite do
            local player = game.Players.LocalPlayer
            -- Check both Backpack and Character for the fruit
            local item = player.Backpack:FindFirstChild(fruitName) 
                        or player.Character:FindFirstChild(fruitName)
            if item then
                game.ReplicatedStorage.GameEvents.Favorite_Item:FireServer(item)
            end
            wait(0.2)
        end
    end)
end

-- Function to stop auto-favoriting fruit
local function stopAutoFavorite()
    autoFavorite = false
end

-- Hook PetsService:FireServer to detect equip/unequip dynamically
local PetsService = game.ReplicatedStorage.GameEvents.PetsService
local oldFireServer = PetsService.FireServer

PetsService.FireServer = function(self, action, id, cframe)
    -- Determine CFrame dynamically if equipping the pet
    local finalCFrame = cframe
    if action == "EquipPet" and id == petId then
        local player = game.Players.LocalPlayer
        local pet = player.Backpack:FindFirstChild(id) or player.Character:FindFirstChild(id)
        if pet and pet.PrimaryPart then
            finalCFrame = pet.PrimaryPart.CFrame
        else
            finalCFrame = CFrame.new() -- fallback
        end
    end

    -- Call the original FireServer
    oldFireServer(self, action, id, finalCFrame)

    -- Auto start/stop favorite loop
    if id == petId then
        if action == "EquipPet" then
            startAutoFavorite()
        elseif action == "UnequipPet" then
            stopAutoFavorite()
        end
    end
end
